<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>ë¡œê·¸ì¸ ì™„ë£Œ</title>
    <style>
        body { font-family: sans-serif; text-align: center; padding-top: 100px; }
        .container { border: 1px solid #eee; padding: 30px; display: inline-block; border-radius: 15px; box-shadow: 0 4px 6px rgba(0,0,0,0.1); }
        .btn { display: inline-block; background: #007bff; color: white; padding: 12px 24px; text-decoration: none; border-radius: 8px; font-weight: bold; margin-top: 20px; }
    </style>
</head>
<body>
<div class="container">
    <h1>âœ… ë¡œê·¸ì¸ ì„±ê³µ</h1>
    <p>í¬ì¸íŠ¸ ì¶©ì „ í˜ì´ì§€ë¡œ ì´ë™í•  ì¤€ë¹„ê°€ ë˜ì—ˆìŠµë‹ˆë‹¤.</p>
    <div><a href="/payment-test.html" class="btn">í¬ì¸íŠ¸ ì¶©ì „í•˜ëŸ¬ ê°€ê¸°</a></div>
</div>

<script>
    // 1. URL ì¿¼ë¦¬ íŒŒë¼ë¯¸í„°ì—ì„œ accessToken ì¶”ì¶œ
    const params = new URLSearchParams(window.location.search);
    const accessToken = params.get("accessToken");

    if (accessToken) {
        localStorage.setItem("accessToken", accessToken);

        // ë‚´ ì •ë³´ ì¡°íšŒí•˜ì—¬ ìƒíƒœ í™•ì¸
        fetch('api/members/me', {
            method: 'GET',
            headers: {'Authorization': 'Bearer ' + accessToken}
        })
        .then(response => {
            if (!response.ok) throw new Error("ì¸ì¦ ì‹¤íŒ¨");
            return response.json();
        })
        .then(res => {
            const member = res.data;
            const contentDiv = document.getElementById('content');

            if (member.status === 'PENDING_PROFILE') {
                // ì˜¨ë³´ë”© ë¯¸ì™„ë£Œ -> ì˜¨ë³´ë”© í˜ì´ì§€ë¡œ ê°•ì œ ì´ë™
                alert('ê°€ì…ì„ í™˜ì˜í•©ë‹ˆë‹¤! \n ì›í• í•œ ë§¤ì¹­ì„ ìœ„í•´ í”„ë¡œí•„ì„ ì™„ì„±í•´ì£¼ì„¸ìš”.');
                window.location.href = '/onboarding.html'
            } else {
                // ì˜¨ë³´ë”© ì™„ë£Œ -> ë©”ì¸ í™ˆí˜ì´ì§€ í™”ë©´ ë Œë”ë§
                contentDiv.innerHTML = `
                    <h1>ğŸ‰ í™˜ì˜í•©ë‹ˆë‹¤, ${member.nickname}ë‹˜!</h1>
                    <p>í¬ì§€ì…˜: ${member.position} | ì§€ì—­: ${member.region}</p>
                    <p>ë‹¹ì‹ ì˜ ëª¨í—˜ì„ ì‹œì‘í•˜ì„¸ìš”.</p>
                `;
            }
        })
        .catch(err => {
            console.error(err);
            alert('ì„¸ì…˜ì´ ë§Œë£Œë˜ì—ˆìŠµë‹ˆë‹¤. ë‹¤ì‹œ ë¡œê·¸ì¸í•´ì£¼ì„¸ìš”.');
            localStorage.removeItem("accessToken");
            window.location.href = "/login.html";
        })
    }
</script>
</body>
</html>
